{% extends 'base.html' %}
{% load static %}

{% block content %}



      <div class="card overflow-hidden mb-3">

        <!--/.bg-holder-->

        <div class="card-body position-relative">
          {% if messages %}
          <div>

            {% for message in messages %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">{{message}}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>
            {% endfor %}
          </div>
          {% endif %}

          <h3>Confirm Choices (click purchase)</h3>
          <p>You have chosen the following upgrade options for an upgrade price of <strong class="lead text-primary fs-2">{{ request.session.upgrade_price }}</strong>:</p>
          <p class="lead">Number of additional Individual Images = <span class="lead text-primary fs-2">{{ request.session.number_of_additional_entries }}</span></p>
          <p class="lead">Number of additional Projects  = <span class="lead text-primary fs-2">{{ request.session.number_of_additional_portfolios }}</span></p>

            <div class="row g-0">
              <div class="col-12 mb-3">
                <div class="row justify-content-center justify-content-sm-between border border-dark rounded p-3">

                    <p><strong>For $20 you can get a 50% discount coupon</strong> for any or all of our available books (including Volume Three when it is announced for pre-order). Save up to $110 on our retail prices! We'll include the code in your confirmation email.</p>

                    <img src="/static/imgs/bundle-one-two-three-onwhite.jpg" style="width:300px; margin-left:auto; margin-right: auto; padding-bottom: 20px">

                    <p style="text-align: center"><em>Yes! I would love to purchase a <strong>50% discount coupon for $20</strong>  <input type="checkbox" name="orderbookcoupon" id="orderbookcoupon" style="outline:0;height: 20px; width:20px; margin-left:auto; margin-right: auto;"></p>

                </div>
              </div>
            </div>

          <button class="button  btn btn-outline-primary " id="submitBtn">Purchase</button>

          <p class="mt-2 fw-light">
          The plan you have chosen includes

          {% if request.session.number_of_entries != '0' %}

              {{ request.session.number_of_entries }} image{% if request.session.number_of_entries != '1' %}s{% endif %} which you can enter into any of our three categories
            {% if request.session.number_of_portfolios == '1' or request.session.number_of_portfolios == '2' %} and {% endif %}
          {%endif%}

          {% if request.session.number_of_portfolios == '1' %}one project entry which allows you to submit one project of 6-10 images{%endif%}
          {% if request.session.number_of_portfolios == '2' %}two project entries which allows you to submit two projects of 6-10 images{%endif%}
          </p>





        </div>
      </div>


{% endblock %}

{% block extra_js %}
<script src="https://js.stripe.com/v3/"></script>  <!-- new -->
<script>
  // Get Stripe publishable key
  fetch("/config/")
  .then((result) => { return result.json(); })
  .then((data) => {
    // Initialize Stripe.js
    const stripe = Stripe(data.publicKey);

    // new
    // Event handler
    document.querySelector("#submitBtn").addEventListener("click", () => {
      // Get Checkout Session ID
      fetch("/create-checkout-session-upgrade/")
      .then((result) => { return result.json(); })
      .then((data) => {
        console.log(data);
        // Redirect to Stripe Checkout
        return stripe.redirectToCheckout({sessionId: data.sessionId})
      })
      .then((res) => {
        console.log(res);
      });
    });
  });
</script>
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

{% endblock %}
